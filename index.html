<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Laura´s und Patrick´s Galerie</title>
<style>
body{margin:0;font-family:sans-serif;background:#f7f8fa;color:#0f172a;padding:20px}
.container{max-width:900px;margin:0 auto;background:white;padding:20px;border-radius:10px;box-shadow:0 4px 20px rgba(0,0,0,0.05)}
h1{margin-top:0;font-size:22px}
.upload-area{border:2px dashed #0f766e;padding:20px;border-radius:10px;text-align:center;margin-bottom:20px;cursor:pointer}
.upload-area.dragover{background:rgba(15,118,110,0.05)}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:12px}
.thumb{position:relative;border-radius:10px;overflow:hidden;background:#fff;padding:6px;box-shadow:0 4px 12px rgba(0,0,0,0.05)}
.thumb img{width:100%;height:100%;object-fit:cover;border-radius:6px}
.thumb .meta{position:absolute;left:8px;bottom:8px;background:rgba(0,0,0,0.45);color:white;padding:4px 6px;border-radius:6px;font-size:12px}
.link-like{background:transparent;border:0;color:#0f766e;cursor:pointer;font-weight:600;margin-left:6px}
</style>
</head>
<body>
<div class="container">
  <h1>Laura´s und Patrick´s Galerie</h1>
  <div class="upload-area" id="dropZone">Ziehe Bilder hier hinein oder klicke zum Hochladen</div>
  <input type="file" id="fileInput" multiple style="display:none">
  <div class="grid" id="gallery"></div>
</div>

<script>
const PASSWORD = "Stuchlik26";
const dropZone = document.getElementById("dropZone");
const fileInput = document.getElementById("fileInput");
const gallery = document.getElementById("gallery");

dropZone.addEventListener("click",()=>fileInput.click());
dropZone.addEventListener("dragover",e=>{e.preventDefault(); dropZone.classList.add("dragover");});
dropZone.addEventListener("dragleave",e=>{dropZone.classList.remove("dragover");});
dropZone.addEventListener("drop",e=>{e.preventDefault(); dropZone.classList.remove("dragover"); handleFiles(e.dataTransfer.files);});
fileInput.addEventListener("change",e=>handleFiles(e.target.files));

async function handleFiles(files){
  for(const file of files){
    const form = new FormData();
    form.append('file', file);
    await fetch('/upload',{method:'POST',body:form});
  }
  loadGallery();
}

async function loadGallery(){
  const res = await fetch('/images');
  const images = await res.json();
  gallery.innerHTML="";
  images.forEach(img=>{
    const card = document.createElement('div');
    card.className="thumb";
    card.innerHTML = `<img src="${img.url}" alt="${img.name}"><div class="meta">${img.name}<button class="link-like" onclick="downloadImage('${img.name}')">Download</button></div>`;
    gallery.appendChild(card);
  });
}

function downloadImage(name){
  const pw = prompt("Passwort eingeben, um das Bild herunterzuladen:");
  if(!pw) return;
  const link = document.createElement('a');
  link.href = `/download/${encodeURIComponent(name)}?pw=${encodeURIComponent(pw)}`;
  link.click();
}

loadGallery();
</script>
</body>
</html>
